# Add this location block to your existing Nginx server configuration
# (inside the HTTPS server block for data-dev.clay.cl)

location /outline/ {
    # Proxy to FastAPI Outline MCP proxy
    proxy_pass http://localhost:8000/;

    # Headers
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;

    # WebSocket support (required for MCP)
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";

    # Timeouts for container creation (90 seconds)
    proxy_connect_timeout 90s;
    proxy_send_timeout 90s;
    proxy_read_timeout 90s;

    # Optional: Enable authentication if needed
    # auth_basic "Clay Restricted Content";
    # auth_basic_user_file /etc/nginx/.htpasswd;
}

# Optional: Add stats endpoint with auth
# location /outline/stats {
#     auth_basic "Clay Restricted Content";
#     auth_basic_user_file /etc/nginx/.htpasswd;
#
#     proxy_pass http://localhost:8000/stats;
#     proxy_set_header Host $host;
#     proxy_set_header X-Real-IP $remote_addr;
#     proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#     proxy_set_header X-Forwarded-Proto $scheme;
# }
