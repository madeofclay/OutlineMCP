# Nginx Location Block for Outline MCP Proxy
#
# Add this block to your existing Nginx server configuration
# Location: Inside the HTTPS server block (usually port 443)
#
# URL: https://data-dev.clay.cl/outline/
# Backend: localhost:8000 (FastAPI)
#
# ============================================================================

location /outline/ {
    # Proxy to FastAPI Outline MCP proxy on localhost:8000
    proxy_pass http://localhost:8000/;

    # Standard headers
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;

    # WebSocket support (REQUIRED for MCP)
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";

    # Timeouts for Docker container creation (90 seconds)
    proxy_connect_timeout 90s;
    proxy_send_timeout 90s;
    proxy_read_timeout 90s;

    # Optional: Authentication with existing .htpasswd
    # Uncomment to enable basic auth
    # auth_basic "Clay Restricted Content";
    # auth_basic_user_file /etc/nginx/.htpasswd;
}

# Optional: Separate endpoint for stats with authentication
# Uncomment to enable
# location /outline/stats {
#     auth_basic "Clay Restricted Content";
#     auth_basic_user_file /etc/nginx/.htpasswd;
#
#     proxy_pass http://localhost:8000/stats;
#     proxy_set_header Host $host;
#     proxy_set_header X-Real-IP $remote_addr;
#     proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#     proxy_set_header X-Forwarded-Proto $scheme;
# }
